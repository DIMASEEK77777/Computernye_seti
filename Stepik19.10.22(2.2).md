DHCP (Dynamic Host Configuration Protocol) — это протокол динамической конфигурации сетевых устройств.

Протокол предназначен для автоматического получения IP-адреса и других параметров, необходимых для работы сетевых устройств в локальной вычислительной сети.

Спецификации: RFC 2131.

Протокол DHCP на сервере использует порт 67, на клиенте - 68.

Для работы протокола используется широковещание broadcast в пределах текущей подсети (широковещательным доменом). Для взаимодействия с клиентами расположенными в других подсетях использоваться агенты ретрансляции (DHCP Relay).

DHCP является расширением протокола BOOTP, использовавшегося для обеспечения бездисковых рабочих станций IP-адресами.

Протокол используется для упрощения администрирования сети за счет использования специально настроенного сервера для централизованной раздачи IP-адресов и других параметров сетевым устройствам.

Параметры, получаемые по DHCP:

* IP-адрес. Маска подсети.
* Шлюзы по умолчанию.
* Статические маршруты.
* DNS-серверы.
* Сервер синхронизации времени.
* Смещение времени.
* Настройки сервера загрузки – настройки протокола TFTP/BOOTP, необходимые для бездисковой загрузки хостов.
* Списки доступных SMTP и POP серверов.
* Настройки WINS и Netbios
* Размер MTU, время жизни кэша ARP, размер TTL и др.

Алгоритм получения сетевых настроек через DHCP-сервер:

* Клиент посылает в свою подсеть широковещательное сообщение DHCPDISCOVER, в котором могут указываться устраивающие клиента IP-адрес и срок его аренды. В качестве IP-адреса источника указывается 0.0.0.0, в качестве адреса назначения - 255.255.255.255. Если DHCP-сервер отсутствует в подсети, то сообщение будет передано в другие подсети агентами протокола BOOTP.

* Получив запрос от клиента, DHCP-сервер отвечает на него сообщением DHCPOFFER. В сообщение включается предлагаемый IP-адрес (yiaddr) и прочие конфигурации для клиента (адреса маршрутизаторов, DNS-серверов и т.д.). На данном этапе сервер не обязан резервировать адрес, который он отправил клиенту.

* Получив конфигурации от серверов (их может быть несколько, если в подсети более одного DHCP-севрера), клиент отправляет широковещательное сообщение DHCPREQUEST. В нем содержатся идентификатор выбранного сервера и, возможно, желательные значения запрашиваемых параметров конфигурации. На данном этапе допускается, что клиента не устроит ни один из предложенных адресов, тогда он вновь отправит DHCPDISCOVER.

* Получив DHCPREQUEST и убедившись, что в сообщении его идентификатор, сервер проверяет свободен ли в данный момент запрошенный адрес. Если да, то отправляет DHCPACK и вносит запись в базу, иначе отправляет DHCPNACK.

* Получив сообщение DHCPACK, клиент обязан убедиться в уникальности IP-адреса (средствами протокола ARP) и зафиксировать суммарный срок его аренды.

Срок аренды: время, прошедшее между отправкой сообщения DHCPREQUEST и приемом ответного сообщения DHCPACK + срок аренды, указанный в DHCPACK.

Если адрес уже используется другой станцией, клиент отправляет DHCPDECLINE и начинает всю процедуру снова.

* Для досрочного прекращения аренды адреса клиент отправляет серверу сообщение DHCPRELEASE.
